<!DOCTYPE html>
<html lang="en" class="spectrum spectrum--medium spectrum--light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />

    <title>Quick Actions</title>

    <link rel="stylesheet" href="node_modules/@spectrum-css/vars/dist/spectrum-global.css">
    <link rel="stylesheet" href="node_modules/@spectrum-css/vars/dist/spectrum-medium.css">
    <link rel="stylesheet" href="node_modules/@spectrum-css/vars/dist/spectrum-light.css">
    <link rel="stylesheet" href="node_modules/@spectrum-css/page/dist/index-vars.css">
    <link rel="stylesheet" href="node_modules/@spectrum-css/button/dist/index-vars.css">
  </head>
    
  <body>
        <button id="back"
            class="spectrum-Button spectrum-Button--fill spectrum-Button--accent spectrum-Button--sizeL" >
            <span class="spectrum-Button-label">Go Back</span>
        </button>
        <h1> Image Quick Actions </h1>
        <div>
            <input type="file" id="fileInput" />
        </div>
            <img id="image-container" height="420" width="420" />
        <div>
            Choose a Quick Action: 
        </div>
            <ul>
                <button id="image-crop"
                    class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                    <span class="spectrum-Button-label">Image Crop</span>
                </button>
                <button id="image-resize"
                    class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                    <span class="spectrum-Button-label">Image Resize</span>
                </button>
                <button id="convert-to-jpg"
                    class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                    <span class="spectrum-Button-label">Convert PNG to JPEG</span>
                </button>
                <button id="convert-to-png"
                    class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                    <span class="spectrum-Button-label">Convert JPG to PNG</span>
                </button>
                <button id="remove-background"
                    class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                    <span class="spectrum-Button-label">Remove Background</span>
                </button>
                
            </ul>

    <h1> Video Quick Actions </h1> 
    <div>
        Choose a Quick Action: 
    </div>
        <ul>
            <button id="change-speed"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Change Speed</span>
            </button>
            <button id="crop-video"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Crop Video</span>
            </button>
            <button id="convert-to-gif"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Convert to GIF</span>
            </button>
            <button id="convert-to-mp4"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Convert to MP4</span>
            </button>
            <button id="resize-video"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Resize Video</span>
            </button>
            <button id="reverse-video"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Reverse Video</span>
            </button>
            <button id="trim-video"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Trim Video</span>
            </button>
            <button id="merge-videos"
                class="spectrum-Button spectrum-Button--outline spectrum-Button--secondary spectrum-Button--sizeS" >
                <span class="spectrum-Button-label">Merge Videos</span>
            </button>
            
        </ul>
        <h2> Your edited video will appear here </h2>
        <video id="video-container" height="420" width="420" controls></video>
    

        <script type="text/javascript" src="CCEverywhere.js"></script>
        <script type="text/javascript" >
        /* PROJECT_NAME: CCX project folder name */ 
        const PROJECT_NAME = 'cc everywhere';
        /* image: user uploaded file */
        var imageFile;
        /* imageUrl: base64 representation we pass into QA function */
        var imageUrl;
        /* appImage is the image container displayed in sample */
        var appImage = document.getElementById('image-container');
        var appVideo = document.getElementById('video-container');
            
        var ccEverywhere = CCEverywhere.default.initialize(
            {
                clientId: 'c352fd34caa94405ab1a2cfa736bb9f5',
                appName: PROJECT_NAME,
                appVersion: { major: 1, minor: 0 },
                platformCategory: 'web'
            }
        );

        /* This event listener checks to see if the user uploads a new file 
        and reads it into base64 data type for SDK ingestion later */
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const reader = new FileReader();
            imageFile = e.target.files[0];
            // reads file into base 64 data type
            reader.readAsDataURL(imageFile);
            reader.onload = () => {
                let encodedImage = reader.result;
                //  save encoded image into imageUrl
                imageUrl = encodedImage;
                appImage.src = imageUrl;
            }
            reader.onerror = (error) => {
                console.log('error', error);
            };
        })

        /* __________________________________________________________
                        Image Quick Actions 
        __________________________________________________________ */

        const exportOptions = [
            {
                /* Export Button group (parent with drop down) example */
                label: 'Open In',
                optionType: 'group',
                variant: 'cta',
                buttons: [
                {
                    target: "Editor",
                    label: "Express",
                    buttonType: "native",
                    optionType: "button"
                },]
            },
            /* Custom export button */
            {
                target: 'Host',
                id: '@id/random',
                label: 'Save in Your App',
                variant: 'cta',
                optionType: 'button',
                buttonType: 'custom'
            },
            {
                /* Native Button example */
                target: 'Download',
                variant: 'primary',
                optionType: 'button',
                buttonType: 'native'
            }
        ];

        const imageCallbacks = {
            onCancel: () => {},
            onPublish: (publishParams) => {
                imageUrl = publishParams.asset.data;
                appImage.src = imageUrl;
            },
            onError: (err) => {
                console.error('Error received is', err.toString())
            }
        }

        function openImageQuickAction(qa_id) {            
            if (imageUrl) {
                ccEverywhere.openQuickAction({
                    id: qa_id, 
                    inputParams: {
                        asset: {
                            data: imageUrl, 
                            dataType: 'base64', 
                            type: 'image'
                        }, 
                        exportOptions: exportOptions
                    },
                    callbacks: imageCallbacks
                })
            } else {
            /* If there's no file uploaded, we can still call the QA API and the user is prompted to 
            browser for image files in the modal */
                ccEverywhere.openQuickAction({
                    id: qa_id, 
                    inputParams: { exportOptions: exportOptions },
                    callbacks: imageCallbacks
                });
            }
        };

        document.getElementById('image-resize').addEventListener('click', () => {
            openImageQuickAction('image-resize');
        })

        document.getElementById('image-crop').addEventListener('click', () => {
            openImageQuickAction('image-crop');
        })

        document.getElementById('convert-to-jpg').addEventListener('click', () => {
            openImageQuickAction('convert-to-jpg');
        })
        
        document.getElementById('convert-to-png').addEventListener('click', () => {
            openImageQuickAction('convert-to-png');
        })

        document.getElementById('remove-background').addEventListener('click', () => {
            openImageQuickAction('remove-background');
        })

        /* __________________________________________________________
                        Video Quick Actions 
        __________________________________________________________ */

        const videoCallbacks = {
            onCancel: () => {},
            onPublish: (publishParams) => {
                const { exportButtonId, asset } = publishParams;
                // if (exportButtonId === 'open_video_new_tab') {
                //     parent.window.open(asset.data, '_blank');
                // }
                if (exportButtonId === 'open_video_app') {
                    appVideo.src = asset.data;
                }
            },
            onError: (err) => {
                console.error('Error received is', err.toString())
            }
        }
        const videoExportOptions = [
            // {
            //     /* Export Button group (parent with drop down) doesn't work with video QA */
            //     label: 'Open In',
            //     optionType: 'group',
            //     variant: 'cta',
            //     buttons: [
            //     {
            //         target: 'Host',
            //         id: 'open_video_app',
            //         label: 'App',
            //         buttonType: 'custom',
            //         optionType: 'button'
            //     },{
            //         target: 'Host',
            //         id: 'open_video_new_tab',
            //         label: 'New tab',
            //         button: 'custom',
            //         optionType: 'button'
            //     }]
            // },
            {
                target: 'Host',
                id: 'open_video_app',
                label: 'Open in app',
                variant: 'cta',
                optionType: 'button',
                buttonType: 'custom'
            },
            {
                target: 'Download',
                variant: 'primary',
                optionType: 'button',
                buttonType: 'native'
            }
        ];
        function openVideoQuickAction(qa_id) {
            /* file input not supported yet, call the QA API and the user is prompted to 
            browser for image files in the modal */
            ccEverywhere.openQuickAction({
                id: qa_id, 
                inputParams: {
                    exportOptions: videoExportOptions
                },
                callbacks: videoCallbacks
            })
        };
        
        
        document.getElementById('change-speed').addEventListener('click', () => {
            openVideoQuickAction('change-speed');
        })
        document.getElementById('crop-video').addEventListener('click', () => {
            openVideoQuickAction('crop-video');
        })
        document.getElementById('convert-to-gif').addEventListener('click', () => {
            openVideoQuickAction('convert-to-gif');
        })
        document.getElementById('convert-to-mp4').addEventListener('click', () => {
            openVideoQuickAction('convert-to-mp4');
        })
        document.getElementById('resize-video').addEventListener('click', () => {
            openVideoQuickAction('resize-video');
        })
        document.getElementById('reverse-video').addEventListener('click', () => {
            openVideoQuickAction('reverse-video');
        })
        document.getElementById('trim-video').addEventListener('click', () => {
            openVideoQuickAction('trim-video');
        })
        document.getElementById('merge-videos').addEventListener('click', () => {
            openVideoQuickAction('merge-videos');
        })

        // __________________________________________________________


        var backButton = document.getElementById('back');
        backButton.addEventListener('click',  () => {
            window.location.href = 'https://localhost:3000';
        })

            
        </script>
  </body>
  
</html>